method SHOWREJECTEDATTA_GET_ENTITYSET.

  DATA LO_FILTER TYPE  REF TO /IWBEP/IF_MGW_REQ_FILTER.                                                                                                             .
  DATA LT_FILTER_SELECT_OPTIONS TYPE /IWBEP/T_MGW_SELECT_OPTION.
  DATA LV_FILTER_STR TYPE STRING.

  DATA : LT_SELECT TYPE /IWBEP/T_COD_SELECT_OPTIONS,
         LS_SELECT TYPE /IWBEP/S_COD_SELECT_OPTION .

  DATA :  LS_ATTACHMENT TYPE ZCSRF_ATTFINAL,
          LT_ATTACHMENT TYPE TABLE OF ZCSRF_ATTFINAL.

  DATA :LS_FILTER TYPE /IWBEP/S_MGW_SELECT_OPTION.
  DATA :LS_FILTER_RANGE TYPE /IWBEP/S_COD_SELECT_OPTION.

  DATA : LV_BUDNO TYPE ZCSRF_ATTFINAL-znda_internal.

  DATA : ES_ENTITYSET TYPE ZCL_ZCSR_MPC=>ts_showrejectedattachments.

  LO_FILTER = IO_TECH_REQUEST_CONTEXT->GET_FILTER( ).
  LT_FILTER_SELECT_OPTIONS = LO_FILTER->GET_FILTER_SELECT_OPTIONS( ).
  LV_FILTER_STR = LO_FILTER->GET_FILTER_STRING( ).


  READ TABLE IT_FILTER_SELECT_OPTIONS INTO LS_FILTER WITH KEY PROPERTY = 'ZndaInternal'.
  IF SY-SUBRC = 0.
    LT_SELECT[] = LS_FILTER-SELECT_OPTIONS[].
    READ TABLE LT_SELECT INTO LS_SELECT INDEX 1.
    IF SY-SUBRC = 0.
      LV_BUDNO = LS_SELECT-LOW.
    ENDIF.
  ENDIF.


    SELECT * FROM ZCSRF_ATTFINAL
     INTO TABLE LT_ATTACHMENT
     WHERE ZNDA_INTERNAL = LV_BUDNO.

  LOOP AT LT_ATTACHMENT INTO LS_ATTACHMENT.
    ES_ENTITYSET-znda_internal = LV_BUDNO.
    ES_ENTITYSET-sno = LS_ATTACHMENT-sno.
*    lv_no = ls_attachment-sno.
    ES_ENTITYSET-filename = LS_ATTACHMENT-filename.
    ES_ENTITYSET-mimetype = LS_ATTACHMENT-mimetype.
    ES_ENTITYSET-file_content = LS_ATTACHMENT-file_content.
    ES_ENTITYSET-DOCUMENTID =  LS_ATTACHMENT-filename.

*    IF SY-SYSID = 'SBX'.
*      LV_VAL = 'http://TSAPFIORI.HMCL.COM:8000'.
*      LV_VAL = 'proxy/http/tsapfiori.hmcl.com:8000'.
*    ELSEIF SY-SYSID = 'QAS'.
*      LV_VAL = 'http://qsapfiori.hmcl.com:8000'.
*    ELSEIF SY-SYSID = 'PRD'.
*      LV_VAL = 'http://psapfiori.hmcl.com:8000'.
*    ENDIF.
*
*    CONDENSE : LV_NO,LV_VAL.
*    CONCATENATE '/sap/opu/odata/SAP/ZLARS_SYSTEM_SRV/DownloadAttSet(AgrmNoI=' ''''
*               LS_ATTACHMENT-AGRM_NO_I''')/$value' INTO  ES_ENTITYSET-URL.
*    CONDENSE ES_ENTITYSET-URL.


    APPEND ES_ENTITYSET TO ET_ENTITYSET.
    CLEAR ES_ENTITYSET.
  ENDLOOP.



endmethod.
